<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="Bookmark" href="/favicon.ico">
  <link rel="Shortcut Icon" href="/favicon.ico" />
  <!--[if lt IE 9]>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/html5shiv.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/respond.min.js"></script>
    <![endif]-->
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui/css/H-ui.min.css" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/css/H-ui.admin.css" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/lib/Hui-iconfont/1.0.8/iconfont.css" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/skin/default/skin.css" id="skin" />
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/css/style.css" />
  <link rel="stylesheet" href="__PUBLIC__/admin/css/common.css">
  <link rel="stylesheet" href="__PUBLIC__/admin/lib/layui/css/layui.css">
  <!--[if IE 6]>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
  <script type="text/javascript" src="__PUBLIC__/admin/lib/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="__PUBLIC__/admin/js/action.js"></script>
  <script type="text/javascript" src="__PUBLIC__/admin/lib/layui/layui.all.js"></script>
  <script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g2-3.5.1/dist/g2.min.js"></script>
  <script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.data-set-0.10.1/dist/data-set.min.js"></script>
  <!-- <script src="https://gw.alipayobjects.com/os/antv/assets/lib/jquery-3.2.1.min.js"></script> -->

  <style>
    .layui-table-cell {
      height: inherit;
    }

    .layui-table-cell a {
      text-decoration: none;
    }

    ::-webkit-scrollbar {
      display: none
    }

    /* 环图中间信息 */
    .g2-guide-html {
      width: 100px;
      height: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-items: center;
      /* vertical-align: middle;
        text-align: center; */
      /* line-height: 0.2; */
    }

    .g2-guide-html .title {
      font-size: 12px;
      color: #8c8c8c;
      font-weight: 300;
    }

    .g2-guide-html .value {
      font-size: 32px;
      color: #000;
      font-weight: bold;
    }
  </style>
  <title>选择区域</title>
</head>

<body style="background-color: #fff;">
  <div class="panel panel-default" style="border:0px;">
    <div class="panel-body">
      <div class="row cl">
        <div id="mountNode"></div>

      </div>




      <div class="hr-line-dashed"></div>
      <table id="demo" lay-filter="test" lay-data="{id: 'idTest'}"></table>
    </div>

    <!-- <script src="https://cdn.bootcss.com/lodash.js/4.17.5/lodash.core.min.js"></script> -->
    <script src="https://unpkg.com/dayjs"></script>
    <script>
      var table = layui.table;
      var form = layui.form;
      form.render('select'); //必须先渲染下 否则下拉框不显示
      var shopId;
      shopId = parent.$('#adv_id').val()
      /*=============================================
      =            渲染实例            =
      =============================================*/

      
      const allData = JSON.parse('{$all}');  // 所有订单
      const listData = JSON.parse('{$list}'); // 分类订单
      const orderStatus = JSON.parse('{$orderStatus}'); // 订单状态

      var tableIns = table.render({
        elem: '#demo',
        height: 'full-150',
        data: allData,
        page: false,
        limit: shopId,
        cellMinWidth: 80,
        cols: [
          [{
              field: 'id',
              title: 'ID',
              sort: true,
            },
            {
              field: 'order_sn',
              title: '订单号',
              align: 'center',
            },
            {
              field: 'receiver',
              title: '收货人',
              align: 'center',
            },
            {
              field: 'price_h',
              title: '支付金额',
              align: 'center',
            },
            {
              field: 'status',
              title: '订单状态',
              align: 'center',
              sort: true,
              templet: function (d) {
                if(d.back != 0){
                  d.status = 'back'
                }
                return orderStatus[d.status];
              }
            },
            {
              field: 'kuaidi_name',
              title: '配送门店',
              align: 'center',
            },
            {
              field: 'addtime',
              title: '付款时间',
              align: 'center',
              templet: function (d) {
                return dayjs.unix(parseInt(d.addtime)).format('YYYY-MM-DD hh:mm:ss')
              }
            }
          ]
        ]
      });

      /*=====  End of 渲染实例  ======*/


      // 图表生成
      // var data = [{
      //   type: '评估中',
      //   count: 6
      // }, {
      //   type: '设计中',
      //   count: 0
      // }, {
      //   type: '正在开发',
      //   count: 2
      // }, {
      //   type: '已上线',
      //   count: 0
      // }];

      // 图表数据
      var data = JSON.parse('{$g2}');
      var sum = '{$total}';


      var ds = new DataSet();
      var dv = ds.createView().source(data);
      var chart = new G2.Chart({
        container: 'mountNode',
        forceFit: true,
        height: window.innerHeight / 3,
        padding: 'auto'
      });
      chart.source(dv);
      chart.tooltip(false);
      chart.legend({
        position: 'bottom',
        itemGap: 50,
        marker: 'square'
        // offsetX: -100
      });
      chart.coord('theta', {
        radius: 0.75,
        innerRadius: 0.6
      });
      chart.intervalStack().position('count').color('type')
        .opacity(1).label('count', {
          // offset: -10,
          textStyle: {
            fill: '#393D49',
            fontSize: 14,
            shadowBlur: 1,
            shadowColor: 'rgba(0, 0, 0, .45)'
          },
          rotate: 0,
          autoRotate: false,
          formatter: function formatter(text, item) {
            return item.point.type + ':' + String(parseInt(item.point.count / sum * 100)) + '%';
          }
        });
      chart.guide().html({
        position: ['50%', '50%'],
        html: '<div class="g2-guide-html"><p class="title">订单总计</p><p class="value">' + sum + '</p></div>',
      });

      let oldStatus;
      let sourceData;
      // 点击图表 切换数据列表
      chart.on('click', ev => {
        var data = ev.data._origin;
        if (oldStatus != data.status) {
          sourceData = listData[data.status]
          oldStatus = data.status
        } else {
          sourceData = allData
          oldStatus = ''
        }
        tableIns.reload({
          data: sourceData
        });
      });

      // 图表中心信息切换
      chart.on('interval:mouseenter', function (ev) {
        var data = ev.data._origin;
        $(".g2-guide-html").css('opacity', 1);
        $(".g2-guide-html .title").text(data.type);
        $(".g2-guide-html .value").text(data.count);
      });

      chart.on('interval:mouseleave', function () {
        $(".g2-guide-html .title").text('订单总计');
        $(".g2-guide-html .value").text(sum);
      });
      chart.render();
    </script>
</body>

</html>