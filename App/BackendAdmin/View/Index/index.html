<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="Bookmark" href="/favicon.ico">
    <link rel="Shortcut Icon" href="/favicon.ico" />
    <script type="text/javascript" src="__PUBLIC__/admin/js/action.js"></script>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/html5shiv.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/respond.min.js"></script>

    <![endif]-->

    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/static/h-ui.admin/css/style.css" />


    <!--[if IE 6]>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <title>{$_SESSION['system']['sysname']?$_SESSION['system']['sysname']:'小程序商城'} · 后台管理</title>
    <style>
        .menu-li {
            min-width: 150px;
            padding: 10px;
            text-indent: 15px;
            transition: background 0.3s;
            -webkit-transition: background 0.3s;
        }


        .breathe-btn {
            border: 1px solid #FF4040;
            color: #fff;
            font-size: 20px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .3);
            overflow: hidden;
            background-image: -webkit-gradient(linear, left top, left bottom, from(#FF4040), to(#FF0000));
            -webkit-animation-timing-function: ease-in-out;
            -webkit-animation-name: breathe;
            -webkit-animation-duration: 2700ms;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-direction: alternate;
        }

        @-webkit-keyframes breathe {
            0% {
                opacity: .2;
                box-shadow: 0 1px 2px rgba(255, 255, 255, 0.1);
            }
            100% {
                opacity: 1;
                border: 1px solid rgba(255, 99, 71, 1);
                box-shadow: 0 1px 30px rgba(255, 48, 48, 1);
            }
        }
    </style>

</head>

<body>
    <header class="navbar-wrapper">
        <div class="navbar navbar-fixed-top">
            <div class="container-fluid cl">
                <a class="logo navbar-logo f-l mr-10 hidden-xs" href='{:U("index")}'>{$_SESSION['system']['sysname']?$_SESSION['system']['sysname']:'小程序商城'} · 后台管理</a>
                <!-- 这个是在缩小时显示 visible-xs -->
                <a class="logo navbar-logo-m f-l mr-10 visible-xs" href='{:U("index")}'>后台管理</a>
                <!-- 这是缩小时候的menu图标 -->
                <a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
                <nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
                    <ul class="cl">
                        <li>{:$_SESSION['admininfo']['group']}</li>
                        <li class="dropDown dropDown_hover">
                            <a href="#" class="dropDown_A">{:$_SESSION['admininfo']['name']}
                                <i class="Hui-iconfont">&#xe6d5;</i>
                            </a>
                            <!-- todo 这里存在一个bug是当缩小的时候 会有侧边栏的menu 却没有这三个  这样会没法退出的 -->
                            <ul class="dropDown-menu menu radius box-shadow">
                                <!-- <li>
                                    <a href="javascript:;" onClick="myselfinfo()">个人信息</a>
                                </li> -->
                                <li class="menu-li">
                                    <a class="va-m" style="line-height: 2.2;text-align: center;" href="javascript:;" onClick="addFavorite()">
                                        <img class="f-l" src="__PUBLIC__/admin/images/add_favorites.png" alt="加入收藏"> 加入收藏
                                    </a>
                                </li>
                                <li class="menu-li">
                                    <a class="va-m" style="line-height: 2.2;text-align: center;" href="javascript:;" onClick="clearCache()">
                                        <img class="f-l" src="__PUBLIC__/admin/images/clear_the_cache.png" alt="清理缓存"> 清理缓存
                                    </a>
                                </li>
                                <li class="menu-li">
                                    <a class="va-m" style="line-height: 2.2;text-align: center;" href="javascript:;" onClick="logout()">
                                        <img class="f-l" src="__PUBLIC__/admin/images/loout.png" alt="退出登录"> 退出登录
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li id="Hui-msg">
                            <a href="#" title="消息">
                                <!-- 数字角标应该是有内容时才显示 -->
                                <!-- 这个因为现在购物流程不清晰 而且消息数据库及显示也没有什么好的方向 暂时先放下吧 -->
                                <!-- 先做一个 有订单就提示框的东西吧 -->
                                <!-- <span class="badge badge-danger breathe-btn">1</span> -->
                                <i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i>
                            </a>
                        </li>
                        <li id="Hui-skin" class="dropDown right dropDown_hover">
                            <a href="javascript:;" class="dropDown_A" title="换肤">
                                <i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i>
                            </a>
                            <ul class="dropDown-menu menu radius box-shadow">
                                <li>
                                    <a href="javascript:;" data-val="default" title=默认（ "蓝色")>默认（蓝色）</a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-val="dark" title="黑色">黑色</a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-val="green" title="绿色">绿色</a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-val="red" title="红色">红色</a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-val="yellow" title="黄色">黄色</a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-val="orange" title="橙色">橙色</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- 左侧菜单 -->
    <if condition="4 === intval($_SESSION['admininfo']['qx']) ">
    <include File='Page/adminusermenu' />
    <else />
    <include File='Page/shopusermenu' />
    </if>
    
    <!-- /左侧菜单 -->

    <!-- 这个是menu隐藏显示按钮 -->
    <div class="dislpayArrow hidden-xs">
        <a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a>
    </div>
    <section class="Hui-article-box">
        <div id="iframe_box">
            <div class="show_iframe" style="min-width: 650px;">
                <div style="display:none" class="loading"></div>
                <iframe src='{:U("Page/adminindex")}' id="iframe" name="iframe" scrolling="yes" frameborder="0"></iframe>
            </div>
        </div>
    </section>


    <!--_footer 作为公共模版分离出去-->
    <!-- <script type="text/javascript" src="__PUBLIC__/admin/lib/jquery/1.9.1/jquery.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/static/h-ui/js/H-ui.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/static/h-ui.admin/js/H-ui.admin.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/jBox/jBox.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/admin/lib/jBox/plugins/Notice/jBox.Notice.min.js"></script>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/admin/lib/jBox/jBox.css" />
    <link rel="stylesheet" href="__PUBLIC__/admin/lib/jBox/themes/NoticeFancy.css">
    <link rel="stylesheet" href="__PUBLIC__/admin/lib/jBox/plugins/Notice/jBox.Notice.css">
    <!--/_footer 作为公共模版分离出去-->
    <style>
        .jBox-container {
            font-size: 16px;
            letter-spacing: 0.05em;
        }
    </style>
    <!--请在下方写此页面业务相关的脚本-->
    <!-- <script type="text/javascript" src="__PUBLIC__/admin/lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script> -->
    <script type="text/javascript">
        window.onload = function () {
            let CountObj = $("iframe").contents().find("#todayCount");
            localStorage.setItem("currCount", CountObj.html());
        }
        <if condition="$orderMSG == 1 ">
        setInterval(getTodayCount, {$heartbeat}000);
        </if>


        function getTodayCount() {
            var res;
            $.ajax({
                url: '{:U("Page/getTodayCount")}',
                dataType: 'json',
                async: false,
                type: "GET",
                error: function (e) {
                    res = e;
                },
                success: function (data) {
                    res = data;
                }
            });
            let CountObj = $("iframe").contents().find("#todayCount");
            currCount = CountObj.html() ? CountObj.html() : localStorage.currCount;


            //console.log("todayCount" + currCount);
            if (res.count) {
                if (currCount < res.count) {
                    //设置新数据
                    CountObj.html(res.count);
                    localStorage.setItem("currCount", res.count);

                    /*----------  弹出提示框  ----------*/
                    new jBox('Notice', {
                        theme: 'NoticeFancy',
                        attributes: {
                            x: 'right',
                            y: 'bottom'
                        },
                        stack: false,
                        animation: {
                            open: 'tada',
                            close: 'zoomIn'
                        },
                        autoClose: <if condition="$autoClose == 1 ">Math.random() * 8000 + 2000,<else />false,</if>
                        audio: '__PUBLIC__/admin/lib/jBox/audio/bling2',
                        volume: 100,
                        color: 'blue',
                        title: '订单消息',
                        content: '<br/>您有新的订单啦! 请尽快安排发货和处理!',
                        delayOnHover: true,
                        showCountdown: true,
                        closeButton: true,
                    });
                }
            }

        }


        // function myselfinfo() {
        //     layer.open({
        //         type: 1,
        //         area: ['300px', '200px'],
        //         fix: false, //不固定
        //         maxmin: true,
        //         shade: 0.4,
        //         title: '查看信息',
        //         content: '<div>管理员信息</div>'
        //     });
        // }


        /* 清理缓存 */
        function clearCache() {
            var url = "{:U('Index/clearCache')}";
            $.ajax({
                type: 'POST',
                url: url,
                success: function (res) {
                    if (res == 1) {
                        layer.open({
                            title: false,
                            icon: 1,
                            content: '缓存清理完毕', //这里content是一个普通的String
                            time: 2000
                        });
                    } else {
                        layer.open({
                            title: false,
                            icon: 2,
                            content: '清理缓存出错!', //这里content是一个普通的String
                            time: 3000
                        });
                    }
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

        /* 收藏网页 */
        function addFavorite() {
            var url = window.location;
            var title = document.title;
            var ua = navigator.userAgent.toLowerCase();
            if (ua.indexOf("360se") > -1) {
                alert("由于360浏览器功能限制，请按 Ctrl+D 手动收藏！");
            } else if (ua.indexOf("msie 8") > -1) {
                window.external.AddToFavoritesBar(url, title); //IE8
            } else if (document.all) {
                try {
                    window.external.addFavorite(url, title);
                } catch (e) {
                    alert('您的浏览器不支持,请按 Ctrl+D 手动收藏!');
                }
            } else if (window.sidebar) {
                window.sidebar.addPanel(title, url, "");
            } else {
                alert('您的浏览器不支持,请按 Ctrl+D 手动收藏!');
            }
        }

        /* 退出 */
        function logout() {
            layer.confirm('确定要退出？', {
                title: false,
                btn: ['确定', '取消'] //按钮
            }, function () {
                //layer.msg('的确很重要', { icon: 1 });
                location.href = "{:U('Login/logout')}";
            }, function () {
                return;
            });
        }
    </script>

</body>

</html>